# Configuraci√≥n de Conexi√≥n con Tryton

## üìã Requisitos Previos

1. **Servidor Tryton funcionando** en `http://localhost:8000`
2. **CORS habilitado** en la configuraci√≥n de Tryton
3. **Bases de datos creadas** en Tryton

## ‚öôÔ∏è Configuraci√≥n de Tryton

### 1. Archivo de Configuraci√≥n

Tu archivo de configuraci√≥n de Tryton debe estar en `/etc/tryton/trytond.conf` o en la ubicaci√≥n que especifiques al iniciar el servidor.

```ini
# Generated by gnuhealth-control
[database]
uri = postgresql://:5432
path = /opt/gnuhealth/his-50/attach
list = True

[web]
# Listen to all network interfaces.
listen = 0.0.0.0:8000
root = /home/gnuhealth/Downloads/a/
list = True

[jsonrpc]
listen = 0.0.0.0:8000

[web_cors]
enabled = True
origins = *
methods = GET,POST,PUT,DELETE,OPTIONS
headers = Content-Type,Authorization
```

### 2. Iniciar el Servidor Tryton

```bash
# Iniciar Tryton con tu configuraci√≥n
trytond -c /ruta/a/tu/trytond.conf

# O si usas gnuhealth-control
gnuhealth-control start
```

## üîß Configuraci√≥n de la Aplicaci√≥n React

### 1. Verificar Configuraci√≥n

El archivo `env.config.js` debe tener la configuraci√≥n correcta:

```javascript
export const trytonConfig = {
  baseURL: 'http://localhost:8000',
  database: {
    uri: 'postgresql://:5432',
    path: '/opt/gnuhealth/his-50/attach'
  },
  web: {
    listen: '0.0.0.0:8000',
    root: '/home/gnuhealth/Downloads/a/',
    cors: {
      enabled: true,
      origins: '*',
      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
      headers: ['Content-Type', 'Authorization']
    }
  }
};
```

### 2. Iniciar la Aplicaci√≥n React

```bash
npm run dev
```

## üß™ Probar la Conexi√≥n

1. Abre `http://localhost:5173` en tu navegador
2. Verifica que el componente "Estado de Conexi√≥n con Tryton" muestre:
   - ‚úÖ **Conectado** (punto verde)
   - Lista de bases de datos disponibles

3. Si hay errores, revisa:
   - Que el servidor Tryton est√© ejecut√°ndose
   - Que el puerto 8000 est√© disponible
   - Que CORS est√© habilitado

## üîç Soluci√≥n de Problemas

### Error: "Failed to fetch"

**Causa:** El servidor Tryton no est√° ejecut√°ndose o no es accesible.

**Soluci√≥n:**
```bash
# Verificar que Tryton est√© ejecut√°ndose
ps aux | grep trytond

# Verificar el puerto
netstat -tlnp | grep 8000

# Reiniciar Tryton si es necesario
gnuhealth-control restart
```

### Error: "CORS policy"

**Causa:** CORS no est√° configurado correctamente.

**Soluci√≥n:**
Verifica que en tu configuraci√≥n de Tryton tengas:
```ini
[web_cors]
enabled = True
origins = *
methods = GET,POST,PUT,DELETE,OPTIONS
headers = Content-Type,Authorization
```

### Error: "Database not found"

**Causa:** La base de datos no existe en Tryton.

**Soluci√≥n:**
```bash
# Crear una nueva base de datos
trytond-admin -c /ruta/a/tu/trytond.conf -d nombre_base_datos --all

# O usar la interfaz web de Tryton para crear bases de datos
```

## üìù Credenciales de Prueba

La aplicaci√≥n incluye credenciales de ejemplo para facilitar las pruebas:

- **Base de datos:** `demo`
- **Usuario:** `admin`
- **Contrase√±a:** `admin`

## üîê Configuraci√≥n de Seguridad

Para producci√≥n, considera:

1. **Limitar CORS origins** a dominios espec√≠ficos
2. **Usar HTTPS** en lugar de HTTP
3. **Configurar autenticaci√≥n** adicional si es necesario
4. **Limitar m√©todos HTTP** seg√∫n tus necesidades

## üìû Soporte

Si tienes problemas:

1. Verifica los logs de Tryton: `tail -f /var/log/trytond.log`
2. Revisa la consola del navegador para errores JavaScript
3. Verifica que todas las dependencias est√©n instaladas
