# üîß Soluci√≥n para Error de CORS con Tryton

## üö® Problema Identificado

Tu aplicaci√≥n React no puede conectarse a Tryton debido a un error de **CORS (Cross-Origin Resource Sharing)**. Esto significa que el servidor Tryton no est√° configurado para permitir peticiones desde tu aplicaci√≥n web.

## ‚úÖ Soluci√≥n Paso a Paso

### 1. Verificar la Configuraci√≥n de Tryton

Tu archivo de configuraci√≥n de Tryton debe tener la secci√≥n `[web_cors]` correctamente configurada:

```ini
# Generated by gnuhealth-control
[database]
uri = postgresql://:5432
path = /opt/gnuhealth/his-50/attach
list = True

[web]
# Listen to all network interfaces.
listen = 0.0.0.0:8000
root = /home/gnuhealth/Downloads/a/
list = True

[jsonrpc]
listen = 0.0.0.0:8000

# üîß ESTA SECCI√ìN ES CR√çTICA PARA CORS
[web_cors]
enabled = True
origins = *
methods = GET,POST,PUT,DELETE,OPTIONS
headers = Content-Type,Authorization
```

### 2. Verificar que el Servidor Est√© Ejecut√°ndose

```bash
# Verificar si Tryton est√° ejecut√°ndose
ps aux | grep trytond

# Verificar el puerto 8000
netstat -tlnp | grep 8000

# Si no est√° ejecut√°ndose, iniciarlo
gnuhealth-control start
# o
trytond -c /ruta/a/tu/trytond.conf
```

### 3. Reiniciar el Servidor Tryton

**IMPORTANTE:** Despu√©s de cambiar la configuraci√≥n, debes reiniciar el servidor:

```bash
# Detener el servidor
gnuhealth-control stop
# o
pkill trytond

# Iniciar nuevamente
gnuhealth-control start
# o
trytond -c /ruta/a/tu/trytond.conf
```

### 4. Verificar la Configuraci√≥n

Puedes verificar que CORS est√© habilitado haciendo una petici√≥n de prueba:

```bash
# Probar la conexi√≥n con curl
curl -X OPTIONS http://localhost:8000/ \
  -H "Origin: http://localhost:5173" \
  -H "Access-Control-Request-Method: POST" \
  -H "Access-Control-Request-Headers: Content-Type" \
  -v
```

Deber√≠as ver headers como:
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS
Access-Control-Allow-Headers: Content-Type,Authorization
```

## üîç Verificaci√≥n en el Navegador

1. Abre las **Herramientas de Desarrollador** (F12)
2. Ve a la pesta√±a **Network**
3. Recarga la p√°gina
4. Busca la petici√≥n a `localhost:8000`
5. Verifica que no haya errores de CORS

## üõ†Ô∏è Soluciones Alternativas

### Opci√≥n 1: Usar un Proxy de Desarrollo

Si no puedes modificar la configuraci√≥n de Tryton, puedes configurar un proxy en Vite:

```javascript
// vite.config.js
export default {
  server: {
    proxy: {
      '/tryton': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/tryton/, '')
      }
    }
  }
}
```

### Opci√≥n 2: Configurar CORS Espec√≠fico

En lugar de `origins = *`, puedes especificar tu dominio:

```ini
[web_cors]
enabled = True
origins = http://localhost:5173,http://127.0.0.1:5173
methods = GET,POST,PUT,DELETE,OPTIONS
headers = Content-Type,Authorization
```

## üìã Checklist de Verificaci√≥n

- [ ] La secci√≥n `[web_cors]` est√° en tu archivo de configuraci√≥n
- [ ] `enabled = True` est√° configurado
- [ ] `origins = *` est√° configurado (o tu dominio espec√≠fico)
- [ ] El servidor Tryton se reinici√≥ despu√©s de cambiar la configuraci√≥n
- [ ] El servidor est√° ejecut√°ndose en el puerto 8000
- [ ] No hay firewalls bloqueando el puerto

## üÜò Si el Problema Persiste

1. **Verifica los logs de Tryton:**
   ```bash
   tail -f /var/log/trytond.log
   ```

2. **Prueba con una petici√≥n simple:**
   ```bash
   curl -X POST http://localhost:8000/ \
     -H "Content-Type: application/json" \
     -d '{"jsonrpc":"2.0","method":"common.db.list","params":[],"id":1}'
   ```

3. **Verifica que no haya conflictos de puerto:**
   ```bash
   lsof -i :8000
   ```

## üìû Comandos √ötiles

```bash
# Verificar estado de gnuhealth
gnuhealth-control status

# Reiniciar completamente
gnuhealth-control restart

# Ver logs en tiempo real
gnuhealth-control logs

# Verificar configuraci√≥n
trytond --config-file=/ruta/a/tu/trytond.conf --check-config
```

Una vez que hayas aplicado estos cambios, tu aplicaci√≥n React deber√≠a poder conectarse correctamente a Tryton sin errores de CORS.
